(()=>{"use strict";var e,n={237:(e,n,t)=>{var r=t(467),o=t(756),c=t.n(o),a=t(359),i=t.n(a),s={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"]}]},l=null,u=null,d=null,p=null,f=null;function v(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",t=document.createElement("div");t.className="message ".concat(n,"-message"),t.textContent=e;var r=document.querySelector(".container");r?r.appendChild(t):document.body.appendChild(t),setTimeout((function(){t.remove()}),5e3)}function h(){var e=document.getElementById("connect"),n=document.getElementById("language"),t=document.getElementById("role");e&&(e.disabled=!1),n&&(n.disabled=!1),t&&(t.disabled=!1)}function m(){v("Connection failed. Please check your internet connection and try again.","error"),j(),h()}function g(){return w.apply(this,arguments)}function w(){return(w=(0,r.A)(c().mark((function e(){var n,t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={video:{width:{ideal:1280},height:{ideal:720}},audio:!0},e.next=4,navigator.mediaDevices.getUserMedia(n);case 4:return l=e.sent,(t=document.getElementById("localVideo"))&&(t.srcObject=l,t.classList.add("active"),v("Camera and microphone activated","success")),e.abrupt("return",l);case 10:throw e.prev=10,e.t0=e.catch(0),console.error("Error accessing media devices:",e.t0),v("Unable to access camera or microphone. Please check your permissions.","error"),h(),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function k(){try{console.log("Initializing socket connection");var e=i()("https://www.gengo.live",{path:"/socket.io/",transports:["websocket","polling"],reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3,timeout:2e4,withCredentials:!0,autoConnect:!0});return e.on("connect",(function(){var n,t;console.log("Socket connected successfully:",e.id);var r=null===(n=document.getElementById("language"))||void 0===n?void 0:n.value,o=null===(t=document.getElementById("role"))||void 0===t?void 0:t.value;r&&o&&e.emit("join",{language:r,role:o})})),e.on("match",function(){var e=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Matched with peer",n),f=n.room,!n.offer){e.next=5;break}return e.next=5,b();case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("offer",function(){var e=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Received offer"),e.next=3,C(n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("answer",function(){var e=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Received answer"),e.next=3,I(n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("candidate",function(){var e=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Received ICE candidate"),e.next=3,S(n);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),e.on("connect_error",(function(n){console.error("Socket connection error:",n),n.message.includes("xhr poll error")&&(console.log("Falling back to websocket only"),e.io.opts.transports=["websocket"],e.connect()),m()})),e}catch(e){return console.error("Socket initialization error:",e),m(),null}}function x(){return y.apply(this,arguments)}function y(){return(y=(0,r.A)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,d=new RTCPeerConnection(s),l&&l.getTracks().forEach((function(e){d.addTrack(e,l)})),d.ontrack=function(e){var n=document.getElementById("remoteVideo");n&&e.streams[0]&&(n.srcObject=e.streams[0],u=e.streams[0],v("Connected to peer","success"))},d.onicecandidate=function(e){e.candidate&&p&&p.emit("candidate",e.candidate,f)},d.onconnectionstatechange=function(){console.log("Connection state:",d.connectionState),"failed"===d.connectionState&&m()},d.oniceconnectionstatechange=function(){console.log("ICE connection state:",d.iceConnectionState),"disconnected"===d.iceConnectionState&&(v("Lost connection. Attempting to reconnect...","warning"),j(),h())},e.abrupt("return",d);case 10:return e.prev=10,e.t0=e.catch(0),console.error("Error creating peer connection:",e.t0),m(),e.abrupt("return",null);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function b(){return E.apply(this,arguments)}function E(){return(E=(0,r.A)(c().mark((function e(){var n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});case 3:return n=e.sent,e.next=6,d.setLocalDescription(n);case 6:p.emit("offer",n,f),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Error creating offer:",e.t0),m();case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function C(e){return O.apply(this,arguments)}function O(){return(O=(0,r.A)(c().mark((function e(n){var t;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d){e.next=3;break}throw new Error("No peer connection available");case 3:return e.next=5,d.setRemoteDescription(new RTCSessionDescription(n));case 5:return e.next=7,d.createAnswer();case 7:return t=e.sent,e.next=10,d.setLocalDescription(t);case 10:p.emit("answer",t,f),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("Error handling offer:",e.t0),m();case 17:case"end":return e.stop()}}),e,null,[[0,13]])})))).apply(this,arguments)}function I(e){return A.apply(this,arguments)}function A(){return(A=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d){e.next=3;break}throw new Error("No peer connection available");case 3:return e.next=5,d.setRemoteDescription(new RTCSessionDescription(n));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error handling answer:",e.t0),m();case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function S(e){return T.apply(this,arguments)}function T(){return(T=(0,r.A)(c().mark((function e(n){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,d){e.next=3;break}throw new Error("No peer connection available");case 3:return e.next=5,d.addIceCandidate(new RTCIceCandidate(n));case 5:e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error handling ICE candidate:",e.t0),m();case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function R(){return B.apply(this,arguments)}function B(){return(B=(0,r.A)(c().mark((function e(){return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("Starting call process"),e.next=4,g();case 4:if(console.log("Local stream started"),p=k()){e.next=8;break}throw new Error("Failed to initialize socket");case 8:return console.log("Socket initialized"),e.next=11,x();case 11:if(d=e.sent){e.next=14;break}throw new Error("Failed to initialize peer connection");case 14:console.log("Peer connection initialized"),e.next=22;break;case 17:throw e.prev=17,e.t0=e.catch(0),console.error("Error starting call:",e.t0),m(),e.t0;case 22:case"end":return e.stop()}}),e,null,[[0,17]])})))).apply(this,arguments)}function j(){try{l&&(l.getTracks().forEach((function(e){e.stop(),l.removeTrack(e)})),l=null),u&&(u.getTracks().forEach((function(e){e.stop(),u.removeTrack(e)})),u=null),d&&(d.close(),d=null),p&&(p.disconnect(),p=null);var e=document.getElementById("localVideo"),n=document.getElementById("remoteVideo");e&&(e.srcObject=null,e.classList.remove("active")),n&&(n.srcObject=null),f=null,h()}catch(e){console.error("Error during cleanup:",e)}}document.addEventListener("DOMContentLoaded",(function(){var e=document.getElementById("connect");e&&e.addEventListener("click",R)})),window.startCall=R,window.handleConnectionError=m,window.cleanup=j}},t={};function r(e){var o=t[e];if(void 0!==o)return o.exports;var c=t[e]={exports:{}};return n[e].call(c.exports,c,c.exports,r),c.exports}r.m=n,e=[],r.O=(n,t,o,c)=>{if(!t){var a=1/0;for(u=0;u<e.length;u++){for(var[t,o,c]=e[u],i=!0,s=0;s<t.length;s++)(!1&c||a>=c)&&Object.keys(r.O).every((e=>r.O[e](t[s])))?t.splice(s--,1):(i=!1,c<a&&(a=c));if(i){e.splice(u--,1);var l=o();void 0!==l&&(n=l)}}return n}c=c||0;for(var u=e.length;u>0&&e[u-1][2]>c;u--)e[u]=e[u-1];e[u]=[t,o,c]},r.n=e=>{var n=e&&e.__esModule?()=>e.default:()=>e;return r.d(n,{a:n}),n},r.d=(e,n)=>{for(var t in n)r.o(n,t)&&!r.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:n[t]})},r.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n),(()=>{var e={792:0};r.O.j=n=>0===e[n];var n=(n,t)=>{var o,c,[a,i,s]=t,l=0;if(a.some((n=>0!==e[n]))){for(o in i)r.o(i,o)&&(r.m[o]=i[o]);if(s)var u=s(r)}for(n&&n(t);l<a.length;l++)c=a[l],r.o(e,c)&&e[c]&&e[c][0](),e[c]=0;return r.O(u)},t=self.webpackChunkgengo=self.webpackChunkgengo||[];t.forEach(n.bind(null,0)),t.push=n.bind(null,t.push.bind(t))})();var o=r.O(void 0,[680],(()=>r(237)));o=r.O(o)})();